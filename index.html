<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Sarthi CRM - Firebase Cloud</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f8f9fa; }
        .sidebar { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); min-height: 100vh; }
        .sidebar .nav-link { color: #ecf0f1; padding: 12px 20px; }
        .sidebar .nav-link:hover { background: #3498db; border-radius: 5px; }
        .stat-card { background: white; border-left: 4px solid #3498db; border-radius: 8px; }
        .table-container { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .modal-header { background: #3498db; color: white; }
        .btn-primary { background: #3498db; border: none; }
        .btn-primary:hover { background: #2980b9; }
        .badge-paid { background: #27ae60; }
        .badge-pending { background: #f39c12; }
        .loader { display: none; text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar">
                <div class="p-3">
                    <h4 class="text-white mb-4">üìä Business Sarthi</h4>
                    <nav class="nav flex-column">
                        <a class="nav-link active" href="#" data-tab="dashboard">Dashboard</a>
                        <a class="nav-link" href="#" data-tab="sales">Sales</a>
                        <a class="nav-link" href="#" data-tab="customers">Customers</a>
                        <a class="nav-link" href="#" data-tab="settings">Settings</a>
                    </nav>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 p-4">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content">
                    <h2 class="mb-4">Welcome to Cloud CRM ‚òÅÔ∏è</h2>
                    <p class="text-muted">All your data is stored in Firebase Cloud - No server needed!</p>
                    
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="stat-card p-4">
                                <h5>Total Sales</h5>
                                <h3 id="totalSales">‚Çπ0</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card p-4">
                                <h5>Total Customers</h5>
                                <h3 id="totalCustomers">0</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card p-4">
                                <h5>Pending Amount</h5>
                                <h3 id="pendingAmount">‚Çπ0</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card p-4">
                                <h5>Records in Cloud</h5>
                                <h3 id="recordCount">0</h3>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sales Tab -->
                <div id="sales" class="tab-content" style="display:none;">
                    <div class="d-flex justify-content-between mb-4">
                        <h2>Sales Management</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#saleModal">+ Add Sale</button>
                    </div>
                    
                    <div class="loader" id="loader">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>

                    <div class="table-container table-responsive">
                        <table class="table table-hover mb-0" id="salesTable">
                            <thead class="table-light">
                                <tr>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="salesList"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Customers Tab -->
                <div id="customers" class="tab-content" style="display:none;">
                    <h2 class="mb-4">Customer List</h2>
                    <div id="customersList" class="row"></div>
                </div>

                <!-- Settings Tab -->
                <div id="settings" class="tab-content" style="display:none;">
                    <h2 class="mb-4">Settings</h2>
                    <div class="card">
                        <div class="card-body">
                            <h5>Firebase Connection</h5>
                            <p id="firebaseStatus" class="text-success">üü¢ Connected to Firebase Cloud</p>
                            <p class="text-muted">Database: <code>business-sarthi-crm-default-rtdb</code></p>
                            <button class="btn btn-warning" onclick="testConnection()">Test Connection</button>
                            <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sale Modal -->
    <div class="modal fade" id="saleModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Sale</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control mb-3" id="customerName" placeholder="Customer Name">
                    <input type="number" class="form-control mb-3" id="saleAmount" placeholder="Amount">
                    <select class="form-control mb-3" id="saleStatus">
                        <option value="Paid">Paid</option>
                        <option value="Pending">Pending</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="addSale()">Save Sale</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js"></script>

    <script>
        // Firebase Config - ‡§Ö‡§™‡§®‡§æ database URL ‡§Ø‡§π‡§æ‡§Å paste ‡§ï‡§∞‡•ã
        const firebaseConfig = {
            databaseURL: "https://business-sarthi-crm-default-rtdb.firebaseio.com"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Tab Switching
        document.querySelectorAll('[data-tab]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
                document.querySelectorAll('[data-tab]').forEach(l => l.classList.remove('active'));
                
                const tab = e.target.getAttribute('data-tab');
                document.getElementById(tab).style.display = 'block';
                e.target.classList.add('active');
                
                if(tab === 'sales') loadSales();
            });
        });

        // Load Sales from Firebase
        function loadSales() {
            document.getElementById('loader').style.display = 'block';
            db.ref('sales').on('value', (snapshot) => {
                document.getElementById('loader').style.display = 'none';
                const sales = snapshot.val() || {};
                const html = Object.keys(sales).map(key => {
                    const s = sales[key];
                    const badge = s.status === 'Paid' ? 'badge-paid' : 'badge-pending';
                    return `<tr>
                        <td>${s.date || 'N/A'}</td>
                        <td>${s.customer}</td>
                        <td>‚Çπ${s.amount}</td>
                        <td><span class="badge ${badge}">${s.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteSale('${key}')">Delete</button>
                        </td>
                    </tr>`;
                }).join('');
                document.getElementById('salesList').innerHTML = html || '<tr><td colspan="5" class="text-center">No sales yet. Add your first sale!</td></tr>';
                updateStats();
            });
        }

        // Add Sale to Firebase
        function addSale() {
            const customer = document.getElementById('customerName').value;
            const amount = document.getElementById('saleAmount').value;
            const status = document.getElementById('saleStatus').value;

            if(!customer || !amount) {
                alert('Please fill all fields');
                return;
            }

            const newSale = {
                customer,
                amount: parseInt(amount),
                status,
                date: new Date().toISOString().split('T')[0]
            };

            db.ref('sales').push(newSale).then(() => {
                document.getElementById('customerName').value = '';
                document.getElementById('saleAmount').value = '';
                const modal = bootstrap.Modal.getInstance(document.getElementById('saleModal'));
                modal.hide();
                alert('‚úÖ Sale added to Cloud!');
            }).catch(e => alert('Error: ' + e.message));
        }

        // Delete Sale
        function deleteSale(key) {
            if(confirm('Delete this sale?')) {
                db.ref('sales/' + key).remove();
            }
        }

        // Update Stats
        function updateStats() {
            db.ref('sales').once('value', (snapshot) => {
                const sales = snapshot.val() || {};
                let total = 0, pending = 0, count = 0;
                
                Object.values(sales).forEach(s => {
                    total += s.amount || 0;
                    if(s.status === 'Pending') pending += s.amount || 0;
                    count++;
                });

                document.getElementById('totalSales').textContent = '‚Çπ' + total;
                document.getElementById('pendingAmount').textContent = '‚Çπ' + pending;
                document.getElementById('recordCount').textContent = count;
                document.getElementById('totalCustomers').textContent = count;
            });
        }

        // Test Connection
        function testConnection() {
            db.ref('.info/connected').on('value', (snapshot) => {
                if(snapshot.val()) {
                    alert('‚úÖ Connected to Firebase Cloud!');
                } else {
                    alert('‚ùå Disconnected from Cloud');
                }
            });
        }

        // Clear All Data
        function clearAllData() {
            if(confirm('WARNING: This will delete ALL data. Are you sure?')) {
                db.ref('sales').remove().then(() => {
                    alert('All data cleared');
                    location.reload();
                });
            }
        }

        // Load stats on page load
        updateStats();
    </script>
</body>
</html>
